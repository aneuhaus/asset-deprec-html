<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asset Depreciation Calculator</title>
    
    <!-- Meta Tags -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://assets.neuhaus.co">
    <meta property="og:title" content="Asset Depreciation Calculator">
    <meta property="og:description" content="Calculate the depreciation of your assets.">
    <meta property="og:image" content="https://assets.neuhaus.co/og-image.png">
    <meta name="twitter:card" content="summary_large_image">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg'%3e%3ctext y='32' font-size='32'%3eðŸ“‰%3c/text%3e%3c/svg%3e" />

    <style>
        :root {
            --bg-body: #0f172a; --bg-card: #1e293b; --bg-input: #334155;
            --text-main: #f8fafc; --text-muted: #94a3b8;
            --accent: #38bdf8; --danger: #ef4444; --border: #475569;
            --shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: system-ui, -apple-system, sans-serif; }
        body { background: var(--bg-body); color: var(--text-main); line-height: 1.5; padding: 2rem; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* Typography & Layout */
        header { margin-bottom: 2rem; text-align: center; }
        h1 { font-size: 2.5rem; background: linear-gradient(to right, var(--accent), #818cf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        h2 { font-size: 1.25rem; font-weight: 600; }
        .subtitle { color: var(--text-muted); }
        .u-mono { font-family: monospace; color: var(--accent); }
        .u-muted { color: var(--text-muted); font-size: 0.85em; }
        .u-flex { display: flex; align-items: center; gap: 1rem; }
        .u-center { justify-content: center; }
        .u-end { justify-content: flex-end; }
        .hidden { display: none !important; }

        /* Components */
        .card { background: var(--bg-card); border-radius: 1rem; padding: 1.5rem; box-shadow: var(--shadow); border: 1px solid var(--border); margin-bottom: 2rem; }
        .card-header { display: flex; justify-content: space-between; margin-bottom: 1.5rem; }
        
        .btn { padding: 0.75rem 1.5rem; background: var(--accent); color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600; }
        .btn:hover { opacity: 0.9; }
        .btn-sm { padding: 0.4rem 1rem; font-size: 0.85rem; border-radius: 2rem; background: rgba(255,255,255,0.1); border: 1px solid var(--border); }
        .btn-danger { background: transparent; color: var(--danger); border: 1px solid var(--danger); }
        .btn-cancel { background: rgba(239, 68, 68, 0.2) !important; color: var(--danger) !important; border-color: var(--danger) !important; }

        /* Form */
        .add-form-controls { margin-top: 1rem; }
        .add-asset-wrapper { display: none; margin-top: 1rem; animation: fadeIn 0.3s; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem; }
        .form-group { margin-bottom: 0.5rem; }
        label { display: block; margin-bottom: 0.4rem; font-size: 0.875rem; color: var(--text-muted); }
        input, select { width: 100%; padding: 0.75rem; background: var(--bg-input); border: 1px solid var(--border); border-radius: 0.5rem; color: var(--text-main); }
        
        /* Lists & Tables */
        .asset-list { display: grid; gap: 1rem; max-height: 600px; border-bottom: 1px solid var(--border); padding-bottom: 1.5rem; margin-bottom: 1rem; }
        .asset-item { background: rgba(255,255,255,0.03); border: 1px solid var(--border); border-radius: 0.75rem; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
        .asset-info { gap: 0.5rem; font-size: 0.8rem; }
        .analytics-toggle { display: flex; justify-content: center; margin-bottom: 1rem; gap: 1rem; }
        .table-wrap { overflow-x: auto; border: 1px solid var(--border); border-radius: 0.5rem; }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th, td { padding: 1rem; border-bottom: 1px solid var(--border); white-space: nowrap; }
        th { background: rgba(255,255,255,0.05); color: var(--accent); font-size: 0.85rem; text-transform: uppercase; }
        td { color: var(--text-muted); font-variant-numeric: tabular-nums; }
        
        /* Tabs */
        .tab-btn { background: transparent; border: 1px solid var(--border); color: var(--text-muted); padding: 0.5rem 1.5rem; border-radius: 2rem; cursor: pointer; }
        .tab-btn.active { background: var(--accent); color: white; border-color: var(--accent); }
        .report-view { display: none; }
        .report-view.active { display: block; animation: fadeIn 0.3s; }

        .github-corner:hover .octo-arm { animation: octocat-wave 560ms ease-in-out }
        @keyframes octocat-wave {
            0%,100% { transform: rotate(0) }
            20%,60% { transform: rotate(-25deg) }
            40%,80% { transform: rotate(10deg) }
        }
        @media (max-width:500px) {
            .github-corner:hover .octo-arm { animation: none }
            .github-corner .octo-arm { animation: octocat-wave 560ms ease-in-out }
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        @media (max-width: 768px) { .form-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<a href="https://github.com/aneuhaus/asset-deprec-html" class="github-corner" aria-label="View source on GitHub">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:hsl(60, 5%, 22%); color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
    </svg>
</a>
<div class="container">
    <header>
        <h1>Asset Depreciation</h1>
        <p class="subtitle">Straight-Line & Declining Balance Calculator</p>
    </header>

    <div class="card">
        <div class="card-header">
            <h2>Your Assets</h2>
            <span id="total-value" class="u-mono">$0.00</span>
        </div>

        <div id="asset-list" class="asset-list"></div>

        <!-- Add Form -->
        <div class="add-form-controls u-flex u-end">
             <button id="btn-save" class="btn hidden" onclick="handleSave()">Save Asset</button>
             <button id="btn-toggle" class="btn btn-sm" onclick="toggleForm()">+ Add New</button>
        </div>

        <div id="form-container" class="add-asset-wrapper">
            <h3>New Asset</h3>
            <div class="form-grid">
                <div class="form-group"><label>Name</label><input type="text" id="inp-name" placeholder="e.g. Laptop"></div>
                <div class="form-group"><label>Value ($)</label><input type="number" id="inp-value" placeholder="2000"></div>
                <div class="form-group"><label>Lifespan (Yrs)</label><input type="number" id="inp-life" placeholder="5"></div>
                <div class="form-group"><label>Salvage ($)</label><input type="number" id="inp-salvage" placeholder="0"></div>
                <div class="form-group">
                    <label>Mode</label>
                    <select id="inp-mode">
                        <option value="Straight-Line">Straight-Line</option>
                        <option value="Declining Balance">Declining Balance</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <div class="analytics-toggle">
        <button class="tab-btn active" onclick="setTab('individual')">Individual Schedules</button>
        <button class="tab-btn" onclick="setTab('monthly')">Monthly Aggregate</button>
    </div>

    <!-- Views -->
    <div id="view-individual" class="report-view active"></div>
    <div id="view-monthly" class="report-view">
        <div class="card">
            <div class="card-header"><h2>Monthly Aggregate</h2></div>
            <div class="table-wrap">
                <table id="table-monthly">
                    <thead><tr><th>Period</th><th>Months</th><th>Monthly Dep.</th><th>Annualized</th></tr></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Templates -->
<template id="tpl-asset">
    <div class="asset-item">
        <div>
            <h3 class="name"></h3>
            <div class="asset-info u-flex u-muted">
                <span class="value u-mono"></span> | <span class="life"></span> yrs | <span class="mode"></span>
            </div>
        </div>
        <button class="btn btn-danger btn-sm delete-btn">Delete</button>
    </div>
</template>

<template id="tpl-report-card">
    <div class="card">
        <div class="card-header"><h2><span class="r-name"></span> <span class="r-mode u-muted success"></span></h2></div>
        <div class="table-wrap">
            <table>
                <thead><tr><th>Year</th><th>Depreciation</th><th>Book Value</th><th>Monthly</th></tr></thead>
                <tbody class="r-body"></tbody>
            </table>
        </div>
    </div>
</template>

<script>
    const STORAGE_KEY = 'asset_deprec_v2';
    const $ = id => document.getElementById(id);
    const fmtMoney = n => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(n);
    
    let assets = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [
        { id: 1, name: "MacBook Pro", value: 2500, lifespan: 5, mode: "Straight-Line", salvage: 500 },
        { id: 2, name: "Office Server", value: 8000, lifespan: 4, mode: "Declining Balance", salvage: 800 },
        { id: 3, name: "Office Furniture", value: 1200, lifespan: 10, mode: "Straight-Line", salvage: 100 },
        { id: 4, name: "Delivery Van", value: 30000, lifespan: 6, mode: "Declining Balance", salvage: 3000 }
    ];

    function save() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(assets));
        render();
    }

    function render() {
        // Render List
        const list = $('asset-list');
        list.innerHTML = '';
        let total = 0;
        
        assets.forEach(a => {
            total += a.value;
            const node = $('tpl-asset').content.cloneNode(true);
            node.querySelector('.name').textContent = a.name;
            node.querySelector('.value').textContent = fmtMoney(a.value);
            node.querySelector('.life').textContent = a.lifespan;
            node.querySelector('.mode').textContent = a.mode;
            node.querySelector('.delete-btn').onclick = () => {
                if(confirm('Delete?')) { assets = assets.filter(x => x.id !== a.id); save(); }
            };
            list.appendChild(node);
        });
        $('total-value').textContent = fmtMoney(total);

        // Render Individual Reports
        const reports = $('view-individual');
        reports.innerHTML = '';
        assets.forEach(a => {
            const sched = calcSchedule(a);
            const node = $('tpl-report-card').content.cloneNode(true);
            node.querySelector('.r-name').textContent = a.name;
            node.querySelector('.r-mode').textContent = `(${a.mode})`;
            
            const tbody = node.querySelector('.r-body');
            sched.forEach(s => {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td>${s.year}</td><td>${fmtMoney(s.dep)}</td><td>${fmtMoney(s.end)}</td><td class="u-muted">${fmtMoney(s.monthly)}/mo</td>`;
                tbody.appendChild(tr);
            });
            reports.appendChild(node);
        });

        // Render Monthly
        renderMonthly();
    }

    function renderMonthly() {
        // Flatten monthly data
        const maxLife = assets.reduce((max, a) => Math.max(max, a.lifespan), 0) * 12;
        const timeline = new Array(maxLife).fill(0);
        
        assets.forEach(a => {
            const sched = calcSchedule(a);
            sched.forEach(y => {
                const startM = (y.year - 1) * 12;
                for(let i=0; i<12 && (startM+i) < maxLife; i++) timeline[startM+i] += y.monthly;
            });
        });

        const tbody = $('table-monthly').querySelector('tbody');
        tbody.innerHTML = '';
        if (maxLife === 0) return tbody.innerHTML = '<tr><td colspan="4" style="text-align:center">No assets</td></tr>';

        let start = 0;
        const baseDate = new Date(); baseDate.setDate(1);

        while(start < maxLife) {
            let val = timeline[start];
            let end = start;
            while(end + 1 < maxLife && Math.abs(timeline[end+1] - val) < 0.01) end++;
            
            const d1 = new Date(baseDate); d1.setMonth(d1.getMonth() + start);
            const d2 = new Date(baseDate); d2.setMonth(d2.getMonth() + end);
            const label = start === end ? d1.toLocaleDateString('en-US', {month:'short', year:'numeric'}) 
                                        : `${d1.toLocaleDateString('en-US', {month:'short', year:'numeric'})} - ${d2.toLocaleDateString('en-US', {month:'short', year:'numeric'})}`;
            
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${label}</td><td>${end-start+1}</td><td>${fmtMoney(val)}</td><td>${fmtMoney(val*12)}</td>`;
            tbody.appendChild(tr);
            start = end + 1;
        }
    }

    function calcSchedule(asset) {
        let val = asset.value, sched = [];
        const isSL = asset.mode === 'Straight-Line';
        const rate = isSL ? (asset.value - asset.salvage) / asset.lifespan : (2 / asset.lifespan);

        for(let y=1; y<=asset.lifespan; y++) {
            let dep = 0;
            if (isSL) dep = (y === asset.lifespan) ? (val - asset.salvage) : rate;
            else {
                let raw = val * rate;
                dep = raw > (val - asset.salvage) ? (val - asset.salvage) : raw;
            }
            // Double Declining Stop check
            if(!isSL && val <= asset.salvage + 0.1) dep = 0;

            const next = val - dep;
            sched.push({ year: y, dep, end: next, monthly: dep/12 });
            val = next;
        }
        return sched;
    }

    function toggleForm() {
        const pan = $('form-container');
        const btn = $('btn-toggle');
        const saveBtn = $('btn-save');
        const isHidden = getComputedStyle(pan).display === 'none';
        
        pan.style.display = isHidden ? 'block' : 'none';
        btn.textContent = isHidden ? 'Cancel' : '+ Add New';
        btn.classList.toggle('btn-cancel', isHidden);
        saveBtn.classList.toggle('hidden', !isHidden);
    }

    function clearForm() {
        $('inp-name').value = '';
        $('inp-value').value = '';
        $('inp-life').value = '';
        $('inp-salvage').value = '';
        $('inp-mode').value = 'Straight-Line';
    }

    function handleSave() {
        const name = $('inp-name').value;
        if(!name) return alert('Name required');
        
        assets.push({
            id: Date.now(),
            name,
            value: Number($('inp-value').value),
            lifespan: Number($('inp-life').value),
            salvage: Number($('inp-salvage').value),
            mode: $('inp-mode').value
        });
        save();
        toggleForm();
        clearForm();
    }

    function setTab(t) {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.report-view').forEach(v => v.classList.remove('active'));
        event.target.classList.add('active');
        $('view-'+t).classList.add('active');
    }

    // Init
    render();
</script>
</body>
</html>
